openapi: 3.0.4
info:
  title: Microservicio de Usuarios - Undersounds
  version: 1.1.0
  description: |-
    Especificacion OpenAPI del microservicio de "Usuarios" dentro del proyecto "Undersounds" de GPS/ASEE.

    Este microservicio gestiona:
    - Usuarios y tipos de usuario
    - Favoritos (canciones, albumes, artistas)
    - Posts en comunidades
    - Obtención de información de artistas

    El codigo del proyecto esta disponible en el repositorio de GitHub: https://github.com/UniExtremadura/proyecto-gps-25-26-ga05
servers:
- url: /
paths:
  /usuarios:
    get:
      summary: Buscar usuarios por nombre
      tags:
      - Usuarios
      parameters:
      - name: q
        in: query
        description: Termino de busqueda para filtrar usuarios por nombre (requerido)
        required: true
        schema:
          type: string
        example: juan
      responses:
        "200":
          description: Lista de usuarios obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Usuario"
        "400":
          description: Parámetro de búsqueda ausente o inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    post:
      summary: Registrar un nuevo usuario o iniciar sesión
      tags:
      - Usuarios
      requestBody:
        description: Para registro envíe todos los campos de UsuarioCreate. Para login puede enviar sólo correo y contrasena.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UsuarioCreate"
      responses:
        "201":
          description: Usuario registrado correctamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Usuario"
        "200":
          description: Login correcto
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Usuario"
        "400":
          description: Datos de entrada invalidos o correo ya registrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "401":
          description: Credenciales inválidas (login)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /usuarios/{idUsuario}:
    delete:
      summary: Eliminar un usuario por su ID
      tags:
      - Usuarios
      parameters:
      - name: idUsuario
        in: path
        description: ID del usuario
        required: true
        schema:
          type: integer
      responses:
        "204":
          description: Usuario eliminado correctamente
        "400":
          description: ID inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    get:
      summary: Obtener los datos de un usuario por su ID
      tags:
      - Usuarios
      parameters:
      - name: idUsuario
        in: path
        description: ID del usuario
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Usuario obtenido correctamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Usuario"
        "400":
          description: ID inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    patch:
      summary: Modificar los datos de un usuario existente
      tags:
      - Usuarios
      parameters:
      - name: idUsuario
        in: path
        description: ID del usuario
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UsuarioUpdate"
      responses:
        "200":
          description: Usuario modificado con exito
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Usuario"
        "400":
          description: Datos de entrada invalidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /usuarios/{idUsuario}/favoritos/albums:
    get:
      summary: Obtener todos los albumes favoritos de un usuario
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        description: ID del usuario
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Lista de álbumes favoritos (envoltorio con estado)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FavoritosResponseAlbum"
        "400":
          description: idUsuario inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /usuarios/{idUsuario}/favoritos/albums/{idAlbum}:
    delete:
      summary: Eliminar un album de favoritos
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      - name: idAlbum
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Álbum eliminado de favoritos (status OK)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SimpleStatus"
        "400":
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: El álbum no estaba en favoritos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    post:
      summary: Añadir un album a favoritos
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      - name: idAlbum
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Álbum añadido (o ya existente) — devuelve estado OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SimpleStatus"
        "400":
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /usuarios/{idUsuario}/favoritos/artistas:
    get:
      summary: Obtener todos los artistas favoritos de un usuario
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        description: ID del usuario
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Lista de artistas favoritos (envoltorio con estado)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FavoritosResponseArtista"
        "400":
          description: idUsuario inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /usuarios/{idUsuario}/favoritos/artistas/{idArtista}:
    delete:
      summary: Eliminar un artista de favoritos
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      - name: idArtista
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Artista eliminado de favoritos (status OK)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SimpleStatus"
        "400":
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: El artista no estaba en favoritos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    post:
      summary: Añadir un artista a favoritos
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      - name: idArtista
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Artista añadido (o ya existente) — devuelve estado OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SimpleStatus"
        "400":
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /usuarios/{idUsuario}/favoritos/canciones:
    get:
      summary: Obtener todas las canciones favoritas de un usuario
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        description: ID del usuario
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Lista de canciones favoritas (envoltorio con estado)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FavoritosResponseCancion"
        "400":
          description: idUsuario inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /usuarios/{idUsuario}/favoritos/canciones/{idCancion}:
    delete:
      summary: Eliminar una canción de favoritos
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      - name: idCancion
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Canción eliminada de favoritos (status OK)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SimpleStatus"
        "400":
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: La canción no estaba en favoritos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    post:
      summary: Añadir una canción a favoritos
      tags:
      - Favoritos
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      - name: idCancion
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Canción añadida (o ya existente) — devuelve estado OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SimpleStatus"
        "400":
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /comunidades/{idComunidad}/posts:
    get:
      summary: Obtener posts de una comunidad
      tags:
      - Posts de Comunidad
      parameters:
      - name: idComunidad
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Lista de posts obtenida
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Post"
        "400":
          description: ID inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    post:
      summary: Crear un nuevo post en una comunidad
      tags:
      - Posts de Comunidad
      parameters:
      - name: idComunidad
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostCreate"
      responses:
        "201":
          description: Post creado correctamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Post"
        "400":
          description: Datos invalidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno / comunidad no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /posts/{idPost}:
    delete:
      summary: Eliminar un post
      tags:
      - Posts de Comunidad
      parameters:
      - name: idPost
        in: path
        required: true
        schema:
          type: integer
      responses:
        "204":
          description: Post eliminado correctamente
        "400":
          description: ID inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: Post no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    get:
      summary: Obtener detalles de un post
      tags:
      - Posts de Comunidad
      parameters:
      - name: idPost
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Post obtenido correctamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Post"
        "400":
          description: ID inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: Post no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
    patch:
      summary: Modificar un post
      tags:
      - Posts de Comunidad
      parameters:
      - name: idPost
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostUpdate"
      responses:
        "200":
          description: Post modificado correctamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Post"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "404":
          description: Post no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /posts/{idPost}/respuestas:
    get:
      summary: Obtener respuestas a un post
      tags:
      - Posts de Comunidad
      parameters:
      - name: idPost
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Lista de respuestas obtenida
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Post"
        "400":
          description: ID inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
        "500":
          description: Error interno
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /artistas/{idArtista}:
    get:
      summary: Obtener información pública de un artista
      tags:
      - Artistas
      parameters:
      - name: idArtista
        in: path
        description: ID del artista
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Información pública del artista
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ArtistaPublico"
        "400":
          description: ID de artista inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Artista no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

components:
  schemas:
    # Usuario principal
    Usuario:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
        nombre:
          type: string
          example: Juan Perez
        correo:
          type: string
          format: email
          example: juan@example.com
        direccion:
          type: string
          example: "Calle Mayor 123, Caceres"
        telefono:
          type: string
          example: "+34612345678"
        descripcion:
          type: string
          example: Amante de la musica indie y rock alternativo
        urlImagen:
          type: string
          format: uri
          example: https://example.com/avatars/juan.jpg
        tipo:
          type: integer
          description: ID del tipo de usuario (FK a tipoUsuario)
          example: 2
      required:
      - id
      - nombre
      - correo
      - tipo

    UsuarioCreate:
      type: object
      properties:
        nombre:
          type: string
          example: Juan Perez
        correo:
          type: string
          format: email
          example: juan@example.com
        contrasena:
          type: string
          format: password
          example: miPassword123
          writeOnly: true
        direccion:
          type: string
          example: "Calle Mayor 123, Caceres"
        telefono:
          type: string
          example: "+34612345678"
        descripcion:
          type: string
          example: Amante de la musica indie
        urlImagen:
          type: string
          format: uri
          example: https://example.com/avatars/juan.jpg
        tipo:
          type: integer
          example: 1
      required:
      - nombre
      - correo
      - contrasena
      - tipo

    UsuarioUpdate:
      type: object
      properties:
        nombre:
          type: string
        correo:
          type: string
          format: email
        contrasena:
          type: string
          format: password
          writeOnly: true
        direccion:
          type: string
        telefono:
          type: string
        descripcion:
          type: string
        urlImagen:
          type: string
          format: uri

    # Posts
    Post:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
        comentario:
          type: string
          example: "¡Increible concierto de anoche!"
        postPadre:
          type: integer
          nullable: true
          example: null
          description: ID del post padre si es una respuesta
        idUsuario:
          type: integer
          example: 1
        idComunidad:
          type: integer
          example: 3
        fechaCreacion:
          type: string
          format: date-time
          readOnly: true
          example: 2024-10-06T12:00:00Z
      required:
      - id
      - comentario
      - idUsuario
      - idComunidad

    PostCreate:
      type: object
      properties:
        comentario:
          type: string
          example: "¡Increible concierto de anoche!"
        postPadre:
          type: integer
          nullable: true
          example: null
        idUsuario:
          type: integer
          example: 1
      required:
      - comentario
      - idUsuario

    PostUpdate:
      type: object
      properties:
        comentario:
          type: string
      required:
      - comentario

    # Respuestas de error
    Error:
      type: object
      properties:
        codigo:
          type: integer
          example: 404
        mensaje:
          type: string
          example: Recurso no encontrado
      required:
      - codigo
      - mensaje

    ErrorMessage:
      type: object
      properties:
        error:
          type: string
          example: "Mensaje de error descriptivo"

    AlbumFavorito:
      type: object
      properties:
        idAlbum:
          type: integer
          example: 456
        titulo:
          type: string
          example: "Ejemplo Album"
        portada:
          type: string
          format: uri
          example: "https://example.com/albums/456.jpg"
      required:
      - idAlbum

    CancionFavorita:
      type: object
      properties:
        idCancion:
          type: integer
          example: 123
        nombre:
          type: string
          example: "Ejemplo Cancion"
      required:
      - idCancion

    ArtistaFavorito:
      type: object
      properties:
        idArtista:
          type: integer
          example: 789
        nombre:
          type: string
          example: "Ejemplo Artista"
      required:
      - idArtista

    SimpleStatus:
      type: object
      properties:
        status:
          type: string
          example: OK

    FavoritosResponseAlbum:
      type: object
      properties:
        status:
          type: string
          example: OK
        favoritos:
          type: array
          items:
            $ref: "#/components/schemas/AlbumFavorito"

    FavoritosResponseArtista:
      type: object
      properties:
        status:
          type: string
          example: OK
        favoritos:
          type: array
          items:
            $ref: "#/components/schemas/ArtistaFavorito"

    FavoritosResponseCancion:
      type: object
      properties:
        status:
          type: string
          example: OK
        favoritos:
          type: array
          items:
            $ref: "#/components/schemas/CancionFavorita"

    # Artistas (endpoint público)
    ArtistaPublico:
      type: object
      properties:
        id:
          type: integer
          example: 42
        nombre:
          type: string
          example: "La Banda"
        biografia:
          type: string
          example: "Banda indie de ejemplo."
        imagen:
          type: string
          format: uri
          example: "https://example.com/artistas/42.jpg"
        enlaces:
          type: array
          items:
            $ref: "#/components/schemas/Enlace"
        discografia:
          type: array
          items:
            $ref: "#/components/schemas/AlbumResumen"
      required:
      - id
      - nombre

    Enlace:
      type: object
      properties:
        nombre:
          type: string
          example: "Sitio oficial"
        url:
          type: string
          format: uri
          example: "https://labanda.example.com"

    AlbumResumen:
      type: object
      properties:
        idAlbum:
          type: integer
          example: 100
        titulo:
          type: string
          example: "Primer Album"
        año:
          type: integer
          example: 2020
        portada:
          type: string
          format: uri
          example: "https://example.com/albums/100.jpg"